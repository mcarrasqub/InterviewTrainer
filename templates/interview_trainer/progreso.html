
{% extends 'base.html' %}
{% block title %}Progreso de usuario - Lumo{% endblock %}
{% block extra_css %}
	<style>
	body {
		background: linear-gradient(120deg, #e0e7ff 0%, #f3e8ff 100%);
	}
	.main-title {
		font-size: 3.2rem;
		font-weight: 900;
		color: #1E293B;
		letter-spacing: 2px;
		text-shadow: 0 2px 10px rgba(79,70,229,0.08);
		margin-bottom: 2.5rem;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}
	.chart-title {
		font-size: 1.5rem;
		font-weight: 800;
		color: #7C3AED;
		letter-spacing: 1.5px;
		margin-bottom: 1.2rem;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}
	.stat-label {
		font-size: 1.15rem;
		font-weight: 700;
		color: #7C3AED;
		letter-spacing: 1px;
		margin-bottom: 0.5rem;
		text-align: center;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}
	.stat-value {
		font-size: 2.8rem;
		font-weight: 900;
		color: #1E293B;
		margin-bottom: 0.2rem;
		text-align: center;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}
	.stat-row {
		display: flex;
		gap: 2rem;
		justify-content: center;
		align-items: stretch;
		margin-bottom: 2.5rem;
		flex-wrap: wrap;
	}
	.stat-card {
		flex: 1 1 0;
		min-width: 220px;
		max-width: 340px;
		height: 180px;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		border-radius: 18px;
		box-shadow: 0 6px 32px rgba(124,58,237,0.10);
		background: linear-gradient(135deg, #f3e8ff 0%, #e0e7ff 100%);
		padding: 2rem 1.5rem;
		border: 2px solid #c7d2fe;
		transition: box-shadow 0.3s, transform 0.2s;
		margin-bottom: 0;
	}
	.stat-card:hover {
		box-shadow: 0 16px 48px rgba(124,58,237,0.18);
		transform: scale(1.035);
	}
	.stat-label {
		font-size: 1.1rem;
		color: #7C3AED;
		font-weight: 600;
		margin-bottom: 0.5rem;
		text-align: center;
	}
	.stat-value {
		font-size: 2.7rem;
		font-weight: 900;
		color: #4F46E5;
		margin-bottom: 0.2rem;
		text-align: center;
	}
	.chart-container {
		background: linear-gradient(135deg, #fff 60%, #e0e7ff 100%);
		border-radius: 18px;
		box-shadow: 0 6px 32px rgba(79,70,229,0.10);
		padding: 2.2rem 1.5rem;
		margin-bottom: 2rem;
		border: 2px solid #c7d2fe;
		width: 100%;
		max-width: 100%;
		overflow-x: auto;
	}
	.chart-title {
		color: #4F46E5;
		font-weight: 700;
		font-size: 1.2rem;
		margin-bottom: 1.2rem;
	}
	.img-matplotlib {
		border-radius: 12px;
		border: 2px solid #7C3AED;
		box-shadow: 0 4px 18px rgba(124,58,237,0.12);
		max-height: 320px;
		background: #fff;
	}
	@media (max-width: 991px) {
		.stat-row {
			flex-direction: column;
			gap: 1.2rem;
		}
		.stat-card {
			max-width: 100%;
			width: 100%;
			margin-bottom: 0.8rem;
			height: 150px;
		}
		.chart-container {
			padding: 1.2rem 0.5rem;
			margin-bottom: 1.2rem;
		}
	}
	@media (max-width: 767px) {
		.main-title {
			font-size: 2.1rem;
			margin-bottom: 1.2rem;
		}
		.stat-row {
			gap: 0.7rem;
		}
		.stat-card {
			height: 120px;
			padding: 1rem 0.5rem;
		}
		.chart-title {
			font-size: 1.1rem;
		}
		.chart-container {
			padding: 0.7rem 0.2rem;
		}
		#sessionsChartWrapper, #skillsRadarWrapper {
			max-width: 100vw;
			width: 100vw;
			height: 260px;
		}
		#sessionsChart, #skillsRadar {
			width: 100vw !important;
			height: 260px !important;
			max-width: 100vw !important;
			max-height: 260px !important;
		}
	}
	@media (max-width: 575px) {
		.container {
			padding-left: 0.2rem !important;
			padding-right: 0.2rem !important;
		}
		.stat-card {
			padding: 0.7rem 0.2rem;
		}
		.chart-container {
			padding: 0.3rem 0.1rem;
		}
		#sessionsChartWrapper, #skillsRadarWrapper {
			height: 180px;
		}
		#sessionsChart, #skillsRadar {
			height: 180px !important;
			max-height: 180px !important;
		}
	}
</style>
{% endblock %}
{% block content %}
<div class="container py-5">
	<h1 class="main-title text-center"><i class="fas fa-chart-bar me-2"></i>Progreso de usuario</h1>
	<div class="stat-row">
		<div class="stat-card">
			<div class="stat-label">Total de Sesiones</div>
			<div id="totalSessions" class="stat-value">0</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">Puntaje Promedio</div>
			<div id="averageScore" class="stat-value">0</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">Sesiones Completadas</div>
			<div id="completedSessions" class="stat-value">0</div>
		</div>
	</div>
	<div class="row g-4 justify-content-center align-items-center flex-lg-row flex-column">
		<div class="col-lg-6 col-md-12 d-flex justify-content-center align-items-center mb-4 mb-lg-0">
			<div class="chart-container d-flex flex-column align-items-center justify-content-center" style="min-height:260px;">
				<div class="chart-title"><i class="fas fa-bar-chart me-2"></i>Puntaje por Sesión Reciente</div>
				<div id="sessionsChartWrapper" style="width:100%;max-width:400px;height:400px;display:flex;align-items:center;justify-content:center;position:relative;">
					<canvas id="sessionsChart" width="400" height="400" style="max-width:100%;max-height:100%;display:none;"></canvas>
					<div id="sessionsPlaceholder" style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;top:0;left:0;">
						<i class="fas fa-folder-open" style="font-size:3rem;color:#7C3AED;margin-bottom:1rem;"></i>
						<div style="color:#4F46E5;font-size:1.2rem;font-weight:600;letter-spacing:1px;">Aún no hay datos disponibles</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-6 col-md-12 d-flex justify-content-center align-items-center mb-4 mb-lg-0">
			<div class="chart-container d-flex flex-column align-items-center justify-content-center" style="min-height:260px;">
				<div class="chart-title"><i class="fas fa-bullseye me-2"></i>Radar de Competencias</div>
				<div id="skillsRadarWrapper" style="width:100%;max-width:400px;height:400px;display:flex;align-items:center;justify-content:center;position:relative;">
					<canvas id="skillsRadar" width="400" height="400" style="max-width:100%;max-height:100%;display:none;"></canvas>
					<div id="skillsPlaceholder" style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;top:0;left:0;">
						<i class="fas fa-chart-pie" style="font-size:3rem;color:#7C3AED;margin-bottom:1rem;"></i>
						<div style="color:#4F46E5;font-size:1.2rem;font-weight:600;letter-spacing:1px;">Aún no hay datos disponibles</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row justify-content-center">
		<div class="col-lg-8 col-md-12">
			<div class="chart-container d-flex flex-column align-items-center justify-content-center" style="min-height:400px;">
				<div class="chart-title"><i class="fas fa-history me-2"></i>Evolución de Puntaje</div>
				<div style="width:100%;max-width:600px;height:400px;display:flex;align-items:center;justify-content:center;">
					<canvas id="scoreEvolutionChart" width="600" height="400" style="max-width:100%;max-height:100%;"></canvas>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script>
// Cargar datos de progreso vía AJAX
fetch("{% url 'interview_trainer:progreso_data' %}")
	.then(res => res.json())
	.then(data => {
		document.getElementById('averageScore').textContent = data.average_score;
		document.getElementById('totalSessions').textContent = data.sessions_labels.length;
		document.getElementById('completedSessions').textContent = data.sessions_labels.filter((_,i) => data.sessions_scores[i] > 0).length;

		// Chart de sesiones con placeholder
		const sessionsChart = document.getElementById('sessionsChart');
		const sessionsPlaceholder = document.getElementById('sessionsPlaceholder');
		if (!data.sessions_scores || data.sessions_scores.length === 0 || data.sessions_scores.every(v => v === 0)) {
			sessionsChart.style.display = 'none';
			sessionsPlaceholder.style.display = 'flex';
		} else {
			sessionsChart.style.display = 'block';
			sessionsPlaceholder.style.display = 'none';
			new Chart(sessionsChart.getContext('2d'), {
				type: 'bar',
				data: {
					labels: data.sessions_labels,
					datasets: [{
						label: 'Puntaje',
						data: data.sessions_scores,
						backgroundColor: 'rgba(124,58,237,0.25)',
						borderColor: 'rgba(79,70,229,1)',
						borderWidth: 3,
						borderRadius: 8,
						hoverBackgroundColor: 'rgba(124,58,237,0.45)'
					}]
				},
				options: {
					scales: { y: { beginAtZero: true, max: 10, grid: { color: '#e0e7ff' } }, x: { grid: { color: '#e0e7ff' } } },
					plugins: {
						legend: { display: false },
						tooltip: { backgroundColor: '#7C3AED', titleColor: '#fff', bodyColor: '#fff' }
					}
				}
			});
		}

		// Radar de competencias con placeholder
		const skillsRadar = document.getElementById('skillsRadar');
		const skillsPlaceholder = document.getElementById('skillsPlaceholder');
		if (!data.skills_scores || data.skills_scores.length === 0 || data.skills_scores.every(v => v === 0)) {
			skillsRadar.style.display = 'none';
			skillsPlaceholder.style.display = 'flex';
		} else {
			skillsRadar.style.display = 'block';
			skillsPlaceholder.style.display = 'none';
			new Chart(skillsRadar.getContext('2d'), {
				type: 'radar',
				data: {
					labels: data.skills_labels,
					datasets: [{
						label: 'Competencias',
						data: data.skills_scores,
						backgroundColor: 'rgba(79,70,229,0.18)',
						borderColor: 'rgba(124,58,237,1)',
						pointBackgroundColor: 'rgba(124,58,237,1)',
						pointBorderColor: '#fff',
						pointRadius: 6,
						pointHoverRadius: 9
					}]
				},
				options: {
					scales: { r: { min: 0, max: 10, angleLines: { color: '#e0e7ff' }, grid: { color: '#e0e7ff' }, pointLabels: { color: '#4F46E5', font: { size: 14, weight: 'bold' } } } },
					plugins: {
						legend: { display: false },
						tooltip: { backgroundColor: '#4F46E5', titleColor: '#fff', bodyColor: '#fff' }
					}
				}
			});
		}
	});
</script>
{% endblock %}
