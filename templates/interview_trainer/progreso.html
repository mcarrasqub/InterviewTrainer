{% extends 'base.html' %}
{% block title %}Progreso de usuario - Lumo{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'interview_trainer/progreso.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
	<h1 class="main-title text-center"><i class="fas fa-chart-simple me-2"></i>Progreso de usuario</h1>
	<div class="stat-row">
		<div class="stat-card"><div class="stat-label">Total de Sesiones</div><div id="totalSessions" class="stat-value">0</div></div>
		<div class="stat-card"><div class="stat-label">Puntaje Promedio</div><div id="averageScore" class="stat-value">0</div></div>
		<div class="stat-card"><div class="stat-label">Sesiones Completadas</div><div id="completedSessions" class="stat-value">0</div></div>
	</div>

	<!-- Modal para gráfico detallado -->
	<div class="modal fade" id="skillModal" tabindex="-1" aria-labelledby="skillModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="skillModalLabel">Competencia</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
				</div>
				<div class="modal-body">
					<div class="d-flex justify-content-between align-items-center mb-3">
						<div><small class="text-muted">Último valor:</small><div id="skillModalLast" class="fw-bold fs-4 text-primary">-</div></div>
						<div><small class="text-muted">Promedio:</small><div id="skillModalMean" class="fw-bold fs-5">-</div></div>
						<div><small class="text-muted">Δ vs anterior</small><div id="skillModalDelta" class="fw-bold fs-5">-</div></div>
					</div>
					<canvas id="skillModalChart" style="width:100%;height:320px;max-height:420px;"></canvas>
				</div>
				<div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div>
			</div>
		</div>
	</div>

	<div class="row g-4 chart-row">
		<div class="col-lg-7 col-md-12">
			<div class="d-flex flex-column gap-4">
				<div class="chart-container d-flex flex-column align-items-start" style="min-height:260px;">
					<div class="chart-title"><i class="fas fa-chart-simple me-2"></i>Puntaje por Sesión Reciente</div>
					<div id="sessionsChartWrapper" class="chart-wrapper chart-wrapper--narrow">
						<canvas id="sessionsChart" width="400" height="400" style="max-width:100%;max-height:100%;display:none;"></canvas>
						<div id="sessionsPlaceholder" class="placeholder">
							<i class="fas fa-folder-open"></i>
							<div>Aún no hay datos disponibles</div>
						</div>
					</div>
				</div>
					<div class="chart-container d-flex flex-column align-items-start" style="min-height:400px;">
						<div class="chart-title"><i class="fas fa-history me-2"></i>Evolución de Puntaje</div>
						<div class="score-evolution-container"><canvas id="scoreEvolutionChart" width="600" height="400" style="max-width:100%;max-height:100%;"></canvas></div>
					</div>
			</div>
		</div>
		<div class="col-lg-5 col-md-12 skills-column">
			<div class="chart-container d-flex flex-column align-items-stretch">
				<div class="chart-title"><i class="fas fa-bullseye me-2"></i>Rendimiento por Habilidad (Evolución)</div>
				<div id="skillsLineWrapper" style="width:100%;display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;gap:0.75rem;">
					<div class="skills-header" style="width:100%;">
						<h3 class="mb-0">Habilidades Blandas</h3>
						<div class="skills-controls">
							<button id="seriesToggle" class="btn btn-sm btn-outline-primary" title="Alternar Histórico / Acumulado">Ver: Histórico</button>
							<select id="skillsSort" class="form-select form-select-sm" style="width:160px;">
								<option value="score_desc">Orden: Puntaje ↓</option>
								<option value="score_asc">Orden: Puntaje ↑</option>
								<option value="alpha">Orden: Alfabético</option>
							</select>
						</div>
					</div>
					<div id="skillsGrid" class="skills-grid" style="width:100%;"></div>
					<div id="skillsPlaceholder" class="placeholder">
						<i class="fas fa-chart-line"></i>
						<div>Aún no hay datos disponibles</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
{% load static %}
<script>
	// Expose the data URL for the static script. Keeps template minimal and tidy.
	window.PROGRESO_DATA_URL = "{% url 'interview_trainer:progreso_data' %}";
</script>
<script src="{% static 'interview_trainer/progreso.js' %}"></script>
{% endblock %}
